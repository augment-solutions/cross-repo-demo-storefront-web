# E-Commerce Storefront Web
# =========================
# Contains: storefront-web Next.js frontend
#
# Note: This service depends on ecomm-core's api-gateway and shared network.
# Make sure ecomm-core is running first, or use the root docker-compose.yml
#
# Usage:
#   Start service:        docker compose up -d
#   View logs:            docker compose logs -f storefront-web
#   Stop service:         docker compose down

services:
  storefront-web:
    build:
      context: .
      dockerfile: services/storefront-web/Dockerfile
      additional_contexts:
        ui-components: ../cross-repo-demo-ui-components
    container_name: ecomm-storefront-web
    environment:
      API_URL: http://ecomm-api-gateway:8064
      NEXT_PUBLIC_API_URL: http://localhost:8064
    ports:
      - "0.0.0.0:3000:3000"
    healthcheck:
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s
      test:
        - CMD
        - wget
        - --quiet
        - --tries=1
        - --spider
        - http://127.0.0.1:3000
    networks:
      - ecomm-network
    restart: unless-stopped

networks:
  ecomm-network:
    external: true
    name: cross-repo-demo-core_ecomm-network